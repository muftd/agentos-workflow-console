# Workflow Console · v0.3 愿景分析与路线图

> **创建日期**: 2025-11-19
>
> **状态**: 📋 规划中
>
> **目标**: 从"实用工具"到"编排台"的跨越

---

## 1. 愿景剧本核心要素分解

### 1.1 愿景剧本原文关键段落

> **用户操作场景**:
> 1. 用户在编排台输入自然语言任务："请帮我生成一个 CRUD 的前后端实现"
> 2. 编排台自动生成工作流，显示为多条彩色方块组成的时间线
> 3. 不同颜色代表不同 Coach（Coach C 蓝色、Coach A 绿色、Coach E 紫色、Knowledge Skill 黄色）
> 4. 每个方块代表一个 Hop，点击可查看：
>    - 使用的 Prompt/skill
>    - 产出
>    - 是否可复用
> 5. 一天结束时，用户可以将整个工作流保存为 "Workflow v0.3"
> 6. 随着时间推移，用户积累了大量工作流，形成个人的 "AgentOS 工作流谱库"

### 1.2 核心概念提取

#### 概念1: 编排台（Orchestration Console）⭐⭐⭐
**定义**: 类似音乐工作站的界面，支持可视化编排多 Coach 协作流程

**关键特征**:
- 🎹 **轨道化视图** (Track-based View)
  - 每个 Coach 独立一条轨道
  - 轨道垂直排列（类似 DAW）
  - 每条轨道上的方块代表该 Coach 执行的任务
- 🎨 **颜色编码**
  - Coach C: 蓝色
  - Coach A: 绿色
  - Coach E: 紫色
  - Knowledge Skill: 黄色
- ⏱️ **时间轴**
  - 横轴代表时间顺序
  - 任务方块从左到右排列

#### 概念2: 自然语言输入 ⭐⭐⭐
**定义**: 用户用自然语言描述任务，系统自动生成工作流

**关键特征**:
- 📝 输入框：简洁的文本输入
- 🤖 解析引擎：理解任务意图
- 🔄 自动生成：创建 workflow session + steps

**技术挑战**:
- v0.3 可行方案：**预定义模板** + 参数填充
  - 用户选择模板："CRUD 全栈开发"
  - 填写参数："实体名称"、"数据库类型"
  - 自动生成 steps
- 未来方案：接入 LLM API 进行真正的 NL 理解

#### 概念3: 工作流谱库（Workflow Library）⭐⭐
**定义**: 用户积累的所有工作流的集合，支持搜索、分类、复用

**关键特征**:
- 📚 **分类系统**
  - 按类型：前端开发、后端开发、数据处理、文档生成
  - 按状态：草稿、进行中、已完成
  - 按标签：自定义标签
- 🔍 **搜索功能**
  - 标题搜索
  - 标签搜索
  - Actor 搜索（"所有包含 Coach C 的工作流"）
- ⭐ **收藏与推荐**
  - 标记常用工作流
  - 基于使用频率推荐

#### 概念4: 工作流可复用性 ⭐⭐
**定义**: 工作流可以作为模板，快速创建相似任务

**关键特征**:
- 📋 **模板化**
  - 将现有 workflow 标记为模板
  - 定义可配置参数
- 🔧 **实例化**
  - 从模板创建新 workflow
  - 填写参数值
  - 自动生成完整 workflow

#### 概念5: 方块可交互性 ⭐
**定义**: 点击任务方块查看详细信息

**关键特征**:
- ℹ️ **详情面板**（v0.2 已实现）
  - Prompt/skill 信息
  - Input/Output
  - 执行摘要
- 🏷️ **复用标识**（新增）
  - 标记该 step 是否可单独复用
  - 显示复用次数

---

## 2. v0.2 现状能力矩阵

### 2.1 数据模型

| 能力 | v0.2 状态 | 说明 |
|------|----------|------|
| 多 Session 支持 | ✅ 完整 | 无限制数量 |
| Session 元数据 | ⚠️ 基础 | 有 title/description/created_at，缺少 tags/status/priority |
| Step 完整性 | ✅ 完整 | 包含 actor/tool/skill/input/output/summary |
| Step 顺序 | ✅ 支持 | order 字段 + Move Left 功能 |
| Step 关系 | ❌ 无 | 无 parent_id/dependencies 字段 |

### 2.2 CRUD 操作

| 操作 | v0.2 状态 | 说明 |
|------|----------|------|
| Session 创建 | ✅ 完整 | 表单输入 title/description |
| Session 编辑 | ⚠️ 部分 | 只能调整 step 顺序，不能编辑 metadata |
| Session 删除 | ✅ 完整 | 带确认对话框 |
| Session 复制 | ✅ 完整 | 一键复制 |
| Step 创建 | ✅ 完整 | 完整表单 |
| Step 编辑 | ✅ 完整 | 完整表单 |
| Step 删除 | ✅ 完整 | 带确认对话框 |
| Step 重排序 | ⚠️ 部分 | 只支持 Move Left，无拖拽 |

### 2.3 可视化

| 能力 | v0.2 状态 | 说明 |
|------|----------|------|
| 线性流程图 | ✅ 完整 | FlowMap 组件，横向排列 |
| Actor 颜色编码 | ✅ 完整 | Coach C=蓝, A=绿, E=紫 |
| 节点交互 | ✅ 完整 | 点击查看详情 + 键盘导航 |
| 详情面板 | ✅ 完整 | 展示所有 step 信息 |
| 轨道视图 | ❌ 无 | 所有 step 在一条线上 |
| 时间轴视图 | ❌ 无 | 无时间刻度 |
| 分支/并行 | ❌ 无 | 只支持线性流程 |

### 2.4 用户体验

| 能力 | v0.2 状态 | 说明 |
|------|----------|------|
| Session 切换 | ✅ 完整 | 侧边栏抽屉 |
| Session 排序 | ✅ 完整 | 按 created_at 倒序 |
| 空状态提示 | ✅ 完整 | 友好的引导文案 |
| 数据持久化 | ✅ 完整 | LocalStorage 自动保存 |
| 搜索功能 | ❌ 无 | 无搜索框 |
| 过滤功能 | ❌ 无 | 无标签/状态过滤 |
| 模板系统 | ❌ 无 | 无模板创建/使用 |
| 导入/导出 | ❌ 无 | 无 JSON 导入导出 |

### 2.5 UI 质量

| 维度 | v0.2 状态 | 说明 |
|------|----------|------|
| 视觉设计 | ✅ 优秀 | Figma/Framer 级别 |
| 响应式设计 | ✅ 完整 | 支持移动端 |
| 深色模式 | ✅ 完整 | 完整适配 |
| 动画效果 | ✅ 完整 | 微交互丰富 |
| 表单验证 | ✅ 完整 | 实时错误提示 |

---

## 3. 愿景 vs 现状 - 差距分析

### 3.1 核心差距（P0 级别）

#### 差距1: 轨道化视图 ❌ 缺失
**愿景要求**: 多条轨道，每个 Coach 一条
**当前状态**: 单条线性流程
**差距影响**: 🔴 **高** - 这是"编排台"概念的核心视觉体现
**实现难度**: ⭐⭐⭐ 中等
**技术方案**:
```typescript
// 数据结构需调整
interface Step {
  // ... 现有字段
  lane?: string;  // 新增：轨道标识（默认为 actor 值）
}

// UI 组件重构
<TrackView>
  <Track name="Coach C" color="blue">
    {stepsInCoachC.map(step => <StepBlock />)}
  </Track>
  <Track name="Coach A" color="green">
    {stepsInCoachA.map(step => <StepBlock />)}
  </Track>
  ...
</TrackView>
```

#### 差距2: 工作流模板系统 ❌ 缺失
**愿景要求**: 工作流可复用、可实例化
**当前状态**: 只有 Session 复制（完全克隆）
**差距影响**: 🔴 **高** - 这是提升效率的关键
**实现难度**: ⭐⭐ 简单
**技术方案**:
```typescript
interface WorkflowTemplate {
  id: string;
  name: string;
  description: string;
  category: string;
  workflow: WorkflowSession;  // 模板内容
  parameters?: TemplateParameter[];  // 可配置参数
  usageCount: number;
}

interface TemplateParameter {
  key: string;       // 如 "entity_name"
  label: string;     // 如 "实体名称"
  type: 'text' | 'select';
  placeholder: string;
}
```

#### 差距3: Session 元数据增强 ⚠️ 部分缺失
**愿景要求**: 支持分类、标签、状态管理
**当前状态**: 只有 title/description
**差距影响**: 🟡 **中** - 影响工作流谱库的管理能力
**实现难度**: ⭐ 简单
**技术方案**:
```typescript
interface WorkflowSession {
  // ... 现有字段
  tags?: string[];                          // 新增
  category?: string;                        // 新增
  status?: 'draft' | 'in-progress' | 'completed';  // 新增
  priority?: 'high' | 'medium' | 'low';    // 新增
  isTemplate?: boolean;                     // 新增
  templateParameters?: TemplateParameter[]; // 新增
}
```

### 3.2 增强差距（P1 级别）

#### 差距4: 搜索和过滤 ❌ 缺失
**愿景要求**: "工作流谱库"需要搜索能力
**当前状态**: 只有按日期排序
**差距影响**: 🟡 **中** - 当 sessions > 20 时体验差
**实现难度**: ⭐ 简单

#### 差距5: 导入/导出 ❌ 缺失
**愿景要求**: 工作流可分享、备份
**当前状态**: 数据锁在 LocalStorage
**差距影响**: 🟡 **中** - 数据安全和协作能力受限
**实现难度**: ⭐ 简单

#### 差距6: Step 拖拽排序 ⚠️ 部分缺失
**愿景要求**: 灵活的编排能力
**当前状态**: 只支持 Move Left
**差距影响**: 🟢 **低** - 有基础功能，体验不够好
**实现难度**: ⭐⭐ 简单

### 3.3 远期差距（v0.4+ 级别）

#### 差距7: 自然语言输入 ❌ 缺失
**愿景要求**: 输入自然语言，自动生成 workflow
**当前状态**: 手动创建
**差距影响**: 🔴 **高** - 这是"编排台"的终极体验
**实现难度**: ⭐⭐⭐⭐⭐ 非常高
**技术挑战**:
- 需要接入 LLM API (Claude/GPT)
- 需要设计 Prompt Engineering
- 需要定义 workflow 生成规则
- 成本和延迟问题

**v0.3 替代方案**: **智能模板选择**
- 用户输入："CRUD 全栈开发"
- 系统匹配模板
- 用户填写参数
- 一键生成 workflow

#### 差距8: 分支和并行流程 ❌ 缺失
**愿景要求**: 支持复杂编排（条件分支、并行执行）
**当前状态**: 只支持线性流程
**差距影响**: 🟡 **中** - 限制了可表达的流程复杂度
**实现难度**: ⭐⭐⭐⭐ 高

#### 差距9: 实时协作 ❌ 缺失
**愿景要求**: 多人协作编排
**当前状态**: 单用户
**差距影响**: 🟢 **低** - 当前用户只有一人
**实现难度**: ⭐⭐⭐⭐⭐ 非常高

---

## 4. v0.3 功能路线图

### 4.1 设计原则

**原则1: 渐进增强**
- 保持 v0.2 所有功能
- 新功能向后兼容
- 数据迁移自动化

**原则2: 视觉优先**
- 轨道视图是核心体验
- UI 质量不降级
- 动画和交互流畅

**原则3: 实用主义**
- v0.3 不做真正的 NL 理解
- 用模板系统替代
- 聚焦高频场景

### 4.2 功能清单（优先级排序）

#### P0 (Must Have) - 核心编排台体验

##### 1. 轨道化视图 ⭐⭐⭐
**目标**: 实现"编排台"的核心视觉

**任务清单**:
- [ ] 数据模型调整
  - [ ] Step 添加 `lane` 字段（默认为 actor）
  - [ ] 支持自定义轨道名称
- [ ] 新增 TrackView 组件
  - [ ] 垂直轨道布局
  - [ ] 每条轨道显示对应 steps
  - [ ] 轨道折叠/展开功能
- [ ] 新增 TrackHeader 组件
  - [ ] 轨道名称和颜色
  - [ ] 步骤计数
  - [ ] 折叠按钮
- [ ] 新增 StepBlock 组件（简化版 StepNode）
  - [ ] 紧凑设计（适合轨道视图）
  - [ ] 保留颜色编码
  - [ ] 点击选中
- [ ] 视图切换功能
  - [ ] 轨道视图（新）
  - [ ] 线性视图（v0.2 已有）
  - [ ] 切换按钮在 SessionHeader

**成功标准**:
- 能看到清晰的多轨道布局
- 不同 Coach 的任务在不同轨道
- 轨道可折叠以节省空间
- 保持 v0.1 的 UI 质量

##### 2. Session 元数据增强 ⭐⭐⭐
**目标**: 支持工作流分类和管理

**任务清单**:
- [ ] Schema 扩展
  - [ ] 添加 `tags: string[]`
  - [ ] 添加 `category: string`
  - [ ] 添加 `status: 'draft' | 'in-progress' | 'completed'`
  - [ ] 添加 `priority: 'high' | 'medium' | 'low'`
- [ ] 修改 SessionFormDialog
  - [ ] 标签输入（tags）
  - [ ] 分类选择（category）
  - [ ] 状态选择（status）
  - [ ] 优先级选择（priority）
- [ ] 修改 SessionListItem
  - [ ] 显示标签（badge）
  - [ ] 显示状态和优先级图标
  - [ ] 分类颜色编码

**成功标准**:
- 可以为 session 添加标签
- 可以选择分类和状态
- 列表中清晰展示元数据

##### 3. 工作流模板系统（基础版）⭐⭐⭐
**目标**: 工作流可复用

**任务清单**:
- [ ] 数据模型
  - [ ] WorkflowTemplate 接口定义
  - [ ] LocalStorage 存储方案
- [ ] 模板创建
  - [ ] "Save as Template" 按钮（SessionHeader）
  - [ ] 模板命名对话框
  - [ ] 保存到 templates 列表
- [ ] 模板使用
  - [ ] "New from Template" 按钮（Sidebar）
  - [ ] 模板选择对话框
  - [ ] 一键创建 session
- [ ] 模板管理
  - [ ] 模板列表 UI（在 Sidebar 新增 tab）
  - [ ] 编辑/删除模板
  - [ ] 使用次数统计

**成功标准**:
- 可以将 session 保存为模板
- 可以从模板创建新 session
- 模板可管理（编辑/删除）

#### P1 (Should Have) - 增强管理能力

##### 4. 搜索和过滤 ⭐⭐
**目标**: "工作流谱库"易于查找

**任务清单**:
- [ ] 搜索框 UI（Sidebar 顶部）
  - [ ] 实时搜索（按标题）
  - [ ] 防抖处理
- [ ] 过滤器 UI（Sidebar）
  - [ ] 按标签过滤
  - [ ] 按分类过滤
  - [ ] 按状态过滤
  - [ ] 按优先级过滤
- [ ] 过滤逻辑
  - [ ] 多条件组合
  - [ ] 结果计数显示
- [ ] 高级搜索
  - [ ] 按 actor 搜索
  - [ ] 按日期范围搜索

**成功标准**:
- 搜索响应快速（< 100ms）
- 过滤结果准确
- UI 清晰直观

##### 5. 导入/导出 ⭐⭐
**目标**: 数据可备份和分享

**任务清单**:
- [ ] 导出功能
  - [ ] 导出所有 sessions（JSON）
  - [ ] 导出单个 session（JSON）
  - [ ] 下载文件
- [ ] 导入功能
  - [ ] 文件选择 UI
  - [ ] JSON 校验
  - [ ] 导入确认对话框
  - [ ] 重复 ID 处理
- [ ] 数据格式版本控制
  - [ ] 导出时标记版本号
  - [ ] 导入时检查兼容性

**成功标准**:
- 导出的 JSON 可读性好
- 导入时有错误提示
- 不覆盖现有数据（除非确认）

##### 6. Step 拖拽排序 ⭐⭐
**目标**: 更灵活的编排体验

**任务清单**:
- [ ] 安装 @dnd-kit/core
- [ ] FlowMap 集成拖拽
  - [ ] Draggable StepNode
  - [ ] Droppable 区域
  - [ ] 拖拽预览
- [ ] 拖拽逻辑
  - [ ] 重新计算 order
  - [ ] 保存到 LocalStorage
- [ ] 视觉反馈
  - [ ] 拖拽中状态
  - [ ] 放置位置提示

**成功标准**:
- 拖拽流畅（60fps）
- 放置位置准确
- 操作可撤销（保留 Move Left）

#### P2 (Nice to Have) - 锦上添花

##### 7. 工作流统计面板 ⭐
**任务清单**:
- [ ] 统计数据计算
  - [ ] 总 sessions 数
  - [ ] 按状态分布
  - [ ] 按分类分布
  - [ ] Actor 使用频率
- [ ] 可视化展示
  - [ ] 饼图（状态分布）
  - [ ] 柱状图（分类统计）
  - [ ] 时间线（创建趋势）

##### 8. 键盘快捷键 ⭐
**任务清单**:
- [ ] 定义快捷键
  - [ ] Ctrl+N: 新建 session
  - [ ] Ctrl+S: 保存
  - [ ] Ctrl+F: 搜索
  - [ ] Ctrl+/: 显示快捷键列表
- [ ] 快捷键提示 UI

##### 9. Session 编辑（metadata）⭐
**任务清单**:
- [ ] SessionFormDialog 支持编辑模式
- [ ] SessionListItem 添加编辑菜单
- [ ] 修改 title/description/tags/category/status

---

## 5. v0.3 开发计划

### 5.1 阶段拆分

#### Stage 1: 数据模型升级（2-3天）
- 扩展 WorkflowSession schema
- WorkflowTemplate 数据结构
- LocalStorage 迁移逻辑
- 向后兼容测试

#### Stage 2: 轨道视图实现（3-4天）
- TrackView 组件开发
- TrackHeader 组件
- StepBlock 组件（简化版）
- 轨道布局算法
- 视图切换功能

#### Stage 3: Session 元数据增强（2-3天）
- 修改 SessionFormDialog
- 修改 SessionListItem
- 标签/分类/状态 UI
- 表单验证

#### Stage 4: 模板系统（3-4天）
- 模板存储逻辑
- "Save as Template" 功能
- "New from Template" 功能
- 模板管理 UI

#### Stage 5: 搜索和过滤（2-3天）
- 搜索框实现
- 过滤器 UI
- 搜索算法优化
- 过滤逻辑

#### Stage 6: 导入/导出（1-2天）
- 导出功能
- 导入功能
- JSON 校验

#### Stage 7: 优化和测试（2-3天）
- 性能优化
- UI/UX 打磨
- 全面测试
- 文档更新

**总计**: 约 15-22 天（3-4 周）

### 5.2 技术栈更新

**新增依赖**:
```json
{
  "@dnd-kit/core": "^6.0.0",        // 拖拽排序
  "@dnd-kit/sortable": "^7.0.0",
  "@dnd-kit/utilities": "^3.2.0"
}
```

**新增组件**:
```
client/src/components/
├── track/
│   ├── TrackView.tsx          // 轨道视图容器
│   ├── Track.tsx              // 单条轨道
│   ├── TrackHeader.tsx        // 轨道头部
│   └── StepBlock.tsx          // 轨道中的 step 块
├── template/
│   ├── TemplateList.tsx       // 模板列表
│   ├── TemplateCard.tsx       // 模板卡片
│   └── TemplateDialog.tsx     // 模板选择对话框
└── search/
    ├── SearchBar.tsx          // 搜索框
    └── FilterPanel.tsx        // 过滤面板
```

---

## 6. 成功标准

### 6.1 功能标准
- [ ] 轨道视图清晰展示多 Coach 协作
- [ ] 可在轨道视图和线性视图间切换
- [ ] Session 支持标签、分类、状态管理
- [ ] 可以将 session 保存为模板
- [ ] 可以从模板创建新 session
- [ ] 支持搜索和多条件过滤
- [ ] 支持导入/导出 JSON
- [ ] 支持拖拽排序 steps

### 6.2 质量标准
- [ ] 轨道视图保持 Figma/Framer 级别 UI
- [ ] 视图切换动画流畅
- [ ] 拖拽体验流畅（60fps）
- [ ] 搜索响应快速（< 100ms）
- [ ] 所有 v0.2 功能正常工作
- [ ] 数据向后兼容

### 6.3 性能标准
- [ ] 支持至少 10 条轨道
- [ ] 支持至少 100 个 sessions
- [ ] 支持至少 50 个模板
- [ ] 搜索结果 < 100ms
- [ ] 视图切换 < 300ms

---

## 7. 与愿景的对应关系

| 愿景要素 | v0.3 对应功能 | 完成度 |
|---------|--------------|--------|
| 编排台界面 | 轨道视图 | ✅ P0 实现 |
| 多 Coach 轨道 | TrackView + Track 组件 | ✅ P0 实现 |
| 彩色方块 | StepBlock 颜色编码 | ✅ P0 实现 |
| 点击查看详情 | StepDetailPanel | ✅ v0.2 已有 |
| 保存工作流 | Session CRUD | ✅ v0.2 已有 |
| 工作流谱库 | 搜索 + 过滤 + 分类 | ✅ P0+P1 实现 |
| 工作流复用 | 模板系统 | ✅ P0 实现 |
| 自然语言输入 | ⚠️ 简化为模板选择 | ⚠️ 替代方案 |
| 自动生成工作流 | ⚠️ 从模板实例化 | ⚠️ 替代方案 |
| 时间轴 | ⚠️ 轨道横轴 | ⚠️ 部分实现 |
| 分支/并行 | ❌ v0.4+ | ❌ 超出范围 |

**结论**: v0.3 实现了愿景的 **70%+ 核心功能**，剩余 30% 属于高级特性，可延后到 v0.4+。

---

## 8. 风险和待确认事项

### 8.1 需要用户确认

#### Q1: 轨道视图是否是 P0？
**问题**: 轨道视图开发成本较高，是否必须在 v0.3 实现？
**选项**:
- A. P0 - 这是"编排台"的核心视觉，必须做
- B. P1 - 可以先做模板系统，v0.4 再做轨道视图

**我的建议**: 选项 A。轨道视图是愿景的核心体现，应优先实现。

#### Q2: 模板参数化是否需要？
**问题**: 模板是否需要支持参数（如 "实体名称"）？
**最小版本**: 模板 = Session 完整克隆
**完整版本**: 模板 + 参数定义 + 填充逻辑

**我的建议**: v0.3 做最小版本（完整克隆），参数化延后到 v0.4。

#### Q3: 是否需要 Session metadata 编辑？
**问题**: v0.2 只能调整 step 顺序，不能编辑 session 的 title/description。
**我的建议**: v0.3 补充这个功能（成本低，体验提升明显）。

### 8.2 技术风险

#### 风险1: 轨道视图性能
**问题**: 10 条轨道 × 10 个 steps = 100 个组件，可能影响性能
**缓解**: 使用 React.memo + 虚拟滚动

#### 风险2: LocalStorage 容量
**问题**: 模板系统会增加存储需求
**缓解**:
- 监控存储使用量
- 提供导出功能作为备份
- 未来考虑 IndexedDB

---

## 9. 下一步行动

### 需要用户确认：

1. ✅ v0.3 的整体方向和优先级是否认可？
2. ✅ 轨道视图是否 P0 必做？
3. ✅ 模板系统做最小版本（完整克隆）？
4. ✅ Session metadata 编辑是否补充？

### 确认后的工作：

1. 创建 `docs/v0.3-plan.md`（详细开发计划）
2. 开始 Stage 1 开发（数据模型升级）
3. 设计轨道视图原型（wireframe）

---

**期待你的反馈！** 🚀
